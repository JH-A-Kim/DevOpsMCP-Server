name: CI Pipeline

on: 
    push:
        branches:
            - main
    pull_request:
        branches:
            - main

jobs:
    build:
        name: Build and Test
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up Python
              uses: actions/setup-python@v5
              with:
                  python-version: '3.9'
                  cache: 'pip' # will cache pip dependencies and make it so its faster for the next runners, looks into the locker and sees that it is empty therefore installs and shoves the dependencies in the cache for next time

            - name: Install dependencies
              run: |
                  python -m pip install --upgrade pip
                  pip install -r requirements.txt

            - name: Run tests
              run: |
                  python -m unittest discover tests

    lint:
        name: Lint Codebase
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up Python
              uses: actions/setup-python@v5
              with:
                  python-version: '3.9'
                  cache: 'pip'

            - name: Install linting tools
              run: |
                  python -m pip install --upgrade pip
                  pip install flake8

            - name: Run linter
              run: |
                  flake8 .
    security:
        name: Security Scan
        runs-on: ubuntu-latest
        steps: 
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up Python
              uses: actions/setup-python@v5
              with:
                  python-version: '3.9'
                  cache: 'pip'

            - name: Install safety
              run: |
                  python -m pip install --upgrade pip
                  pip install safety

            - name: Run security scan
              run: |
                  safety check -r requirements.txt